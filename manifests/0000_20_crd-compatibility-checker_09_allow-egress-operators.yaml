# This NetworkPolicy allows egress traffic required for the crd-compatibility-checker.
# The operator needs broad internet access for cluster management operations,
# cloud provider API calls, and communication with various services.
#
# This policy allows all egress traffic from the crd-compatibility-checker pod, which is
# necessary because the operator needs to communicate with:
# - Kubernetes API server for cluster management operations
# - Cloud provider APIs for infrastructure management
# - External services for health checks and monitoring
# - Webhook services for validation
# - Container registries and other external services
#
# This approach is more practical than overly granular rules since the operator
# needs broad access to function properly in various environments.
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  annotations:
    exclude.release.openshift.io/internal-openshift-hosted: "true"
    include.release.openshift.io/self-managed-high-availability: "true"
    include.release.openshift.io/single-node-developer: "true"
    release.openshift.io/feature-set: CustomNoUpgrade,TechPreviewNoUpgrade
  name: allow-egress-crd-compatibility-checker
  namespace: openshift-cluster-api
spec:
  egress:
    ports:
    # Allow egress traffic to kube-apiserver
    - port: 6443
      protocol: TCP
  podSelector:
    matchExpressions:
    - key: k8s-app
      operator: In
      values:
      - crd-compatibility-checker
  policyTypes:
  - Egress
